{
	"name": "administrativeUnitCN",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CAP_CN_2019",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "AzureDataLakeStorage1",
						"type": "LinkedServiceReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "SplitModelTypes"
				},
				{
					"name": "DeriveGenderColumns"
				},
				{
					"name": "AggregateGenderData"
				},
				{
					"name": "DeriveEngineColumns"
				},
				{
					"name": "UnionAllData"
				},
				{
					"name": "CreateDataArray"
				},
				{
					"name": "AggregateToArray"
				},
				{
					"name": "SelectDataArray"
				}
			],
			"scriptLines": [
				"source(output(",
				"          GroupName as string,",
				"          GroupType as string,",
				"          Anhui as string,",
				"          Beijing as string,",
				"          Chongqing as string,",
				"          Fujian as string,",
				"          Gansu as string,",
				"          Guangdong as string,",
				"          Guangxi as string,",
				"          Guizhou as string,",
				"          Hainan as string,",
				"          Hebei as string,",
				"          Heilongjiang as string,",
				"          Henan as string,",
				"          {Hong Kong} as string,",
				"          Hubei as string,",
				"          Hunan as string,",
				"          {Inner Mongolia} as string,",
				"          Jiangsu as string,",
				"          Jiangxi as string,",
				"          Jilin as string,",
				"          Liaoning as string,",
				"          Macau as string,",
				"          Ningxia as string,",
				"          Qinghai as string,",
				"          Shaanxi as string,",
				"          Shandong as string,",
				"          Shanghai as string,",
				"          Shanxi as string,",
				"          Sichuan as string,",
				"          Tianjin as string,",
				"          Tibet as string,",
				"          Xinjiang as string,",
				"          Yunnan as string,",
				"          Zhejiang as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> source1",
				"source1 split(GroupType == 'Model/Gender',",
				"     GroupType == 'Model/Engine',",
				"     disjoint: false) ~> SplitModelTypes@(ModelGender, ModelEngine)",
				"SplitModelTypes@ModelGender derive(market = 'CN',",
				"          year = '2019',",
				"          model = iif(GroupName == 'Porsche/Female' || GroupName == 'Porsche/Male', 'All Models',",
				"        iif(locate('/', GroupName) > 0, ",
				"            concat(trim(split(GroupName, '/')[1]), ' All'),",
				"            GroupName",
				"        )",
				"    ),",
				"          male_anhui = iif(endsWith(GroupName, '/Male'), toDouble(Anhui), toDouble(0)),",
				"          male_beijing = iif(endsWith(GroupName, '/Male'), toDouble(Beijing), toDouble(0)),",
				"          male_chongqing = iif(endsWith(GroupName, '/Male'), toDouble(Chongqing), toDouble(0)),",
				"          male_fujian = iif(endsWith(GroupName, '/Male'), toDouble(Fujian), toDouble(0)),",
				"          male_gansu = iif(endsWith(GroupName, '/Male'), toDouble(Gansu), toDouble(0)),",
				"          male_guangdong = iif(endsWith(GroupName, '/Male'), toDouble(Guangdong), toDouble(0)),",
				"          male_guangxi = iif(endsWith(GroupName, '/Male'), toDouble(Guangxi), toDouble(0)),",
				"          male_guizhou = iif(endsWith(GroupName, '/Male'), toDouble(Guizhou), toDouble(0)),",
				"          male_hainan = iif(endsWith(GroupName, '/Male'), toDouble(Hainan), toDouble(0)),",
				"          male_hebei = iif(endsWith(GroupName, '/Male'), toDouble(Hebei), toDouble(0)),",
				"          male_heilongjiang = iif(endsWith(GroupName, '/Male'), toDouble(Heilongjiang), toDouble(0)),",
				"          male_henan = iif(endsWith(GroupName, '/Male'), toDouble(Henan), toDouble(0)),",
				"          male_hongkong = iif(endsWith(GroupName, '/Male'), toDouble({Hong Kong}), toDouble(0)),",
				"          male_hubei = iif(endsWith(GroupName, '/Male'), toDouble(Hubei), toDouble(0)),",
				"          male_hunan = iif(endsWith(GroupName, '/Male'), toDouble(Hunan), toDouble(0)),",
				"          male_innermongolia = iif(endsWith(GroupName, '/Male'), toDouble({Inner Mongolia}), toDouble(0)),",
				"          male_jiangsu = iif(endsWith(GroupName, '/Male'), toDouble(Jiangsu), toDouble(0)),",
				"          male_jiangxi = iif(endsWith(GroupName, '/Male'), toDouble(Jiangxi), toDouble(0)),",
				"          male_jilin = iif(endsWith(GroupName, '/Male'), toDouble(Jilin), toDouble(0)),",
				"          male_liaoning = iif(endsWith(GroupName, '/Male'), toDouble(Liaoning), toDouble(0)),",
				"          male_macau = iif(endsWith(GroupName, '/Male'), toDouble(Macau), toDouble(0)),",
				"          male_ningxia = iif(endsWith(GroupName, '/Male'), toDouble(Ningxia), toDouble(0)),",
				"          male_qinghai = iif(endsWith(GroupName, '/Male'), toDouble(Qinghai), toDouble(0)),",
				"          male_shaanxi = iif(endsWith(GroupName, '/Male'), toDouble(Shaanxi), toDouble(0)),",
				"          male_shandong = iif(endsWith(GroupName, '/Male'), toDouble(Shandong), toDouble(0)),",
				"          male_shanghai = iif(endsWith(GroupName, '/Male'), toDouble(Shanghai), toDouble(0)),",
				"          male_shanxi = iif(endsWith(GroupName, '/Male'), toDouble(Shanxi), toDouble(0)),",
				"          male_sichuan = iif(endsWith(GroupName, '/Male'), toDouble(Sichuan), toDouble(0)),",
				"          male_tianjin = iif(endsWith(GroupName, '/Male'), toDouble(Tianjin), toDouble(0)),",
				"          male_tibet = iif(endsWith(GroupName, '/Male'), toDouble(Tibet), toDouble(0)),",
				"          male_xinjiang = iif(endsWith(GroupName, '/Male'), toDouble(Xinjiang), toDouble(0)),",
				"          male_yunnan = iif(endsWith(GroupName, '/Male'), toDouble(Yunnan), toDouble(0)),",
				"          male_zhejiang = iif(endsWith(GroupName, '/Male'), toDouble(Zhejiang), toDouble(0)),",
				"          female_anhui = iif(endsWith(GroupName, '/Female'), toDouble(Anhui), toDouble(0)),",
				"          female_beijing = iif(endsWith(GroupName, '/Female'), toDouble(Beijing), toDouble(0)),",
				"          female_chongqing = iif(endsWith(GroupName, '/Female'), toDouble(Chongqing), toDouble(0)),",
				"          female_fujian = iif(endsWith(GroupName, '/Female'), toDouble(Fujian), toDouble(0)),",
				"          female_gansu = iif(endsWith(GroupName, '/Female'), toDouble(Gansu), toDouble(0)),",
				"          female_guangdong = iif(endsWith(GroupName, '/Female'), toDouble(Guangdong), toDouble(0)),",
				"          female_guangxi = iif(endsWith(GroupName, '/Female'), toDouble(Guangxi), toDouble(0)),",
				"          female_guizhou = iif(endsWith(GroupName, '/Female'), toDouble(Guizhou), toDouble(0)),",
				"          female_hainan = iif(endsWith(GroupName, '/Female'), toDouble(Hainan), toDouble(0)),",
				"          female_hebei = iif(endsWith(GroupName, '/Female'), toDouble(Hebei), toDouble(0)),",
				"          female_heilongjiang = iif(endsWith(GroupName, '/Female'), toDouble(Heilongjiang), toDouble(0)),",
				"          female_henan = iif(endsWith(GroupName, '/Female'), toDouble(Henan), toDouble(0)),",
				"          female_hongkong = iif(endsWith(GroupName, '/Female'), toDouble({Hong Kong}), toDouble(0)),",
				"          female_hubei = iif(endsWith(GroupName, '/Female'), toDouble(Hubei), toDouble(0)),",
				"          female_hunan = iif(endsWith(GroupName, '/Female'), toDouble(Hunan), toDouble(0)),",
				"          female_innermongolia = iif(endsWith(GroupName, '/Female'), toDouble({Inner Mongolia}), toDouble(0)),",
				"          female_jiangsu = iif(endsWith(GroupName, '/Female'), toDouble(Jiangsu), toDouble(0)),",
				"          female_jiangxi = iif(endsWith(GroupName, '/Female'), toDouble(Jiangxi), toDouble(0)),",
				"          female_jilin = iif(endsWith(GroupName, '/Female'), toDouble(Jilin), toDouble(0)),",
				"          female_liaoning = iif(endsWith(GroupName, '/Female'), toDouble(Liaoning), toDouble(0)),",
				"          female_macau = iif(endsWith(GroupName, '/Female'), toDouble(Macau), toDouble(0)),",
				"          female_ningxia = iif(endsWith(GroupName, '/Female'), toDouble(Ningxia), toDouble(0)),",
				"          female_qinghai = iif(endsWith(GroupName, '/Female'), toDouble(Qinghai), toDouble(0)),",
				"          female_shaanxi = iif(endsWith(GroupName, '/Female'), toDouble(Shaanxi), toDouble(0)),",
				"          female_shandong = iif(endsWith(GroupName, '/Female'), toDouble(Shandong), toDouble(0)),",
				"          female_shanghai = iif(endsWith(GroupName, '/Female'), toDouble(Shanghai), toDouble(0)),",
				"          female_shanxi = iif(endsWith(GroupName, '/Female'), toDouble(Shanxi), toDouble(0)),",
				"          female_sichuan = iif(endsWith(GroupName, '/Female'), toDouble(Sichuan), toDouble(0)),",
				"          female_tianjin = iif(endsWith(GroupName, '/Female'), toDouble(Tianjin), toDouble(0)),",
				"          female_tibet = iif(endsWith(GroupName, '/Female'), toDouble(Tibet), toDouble(0)),",
				"          female_xinjiang = iif(endsWith(GroupName, '/Female'), toDouble(Xinjiang), toDouble(0)),",
				"          female_yunnan = iif(endsWith(GroupName, '/Female'), toDouble(Yunnan), toDouble(0)),",
				"          female_zhejiang = iif(endsWith(GroupName, '/Female'), toDouble(Zhejiang), toDouble(0))) ~> DeriveGenderColumns",
				"DeriveGenderColumns aggregate(groupBy(market,",
				"          year,",
				"          model),",
				"     male_anhui = max(male_anhui),",
				"          male_beijing = max(male_beijing),",
				"          male_chongqing = max(male_chongqing),",
				"          male_fujian = max(male_fujian),",
				"          male_gansu = max(male_gansu),",
				"          male_guangdong = max(male_guangdong),",
				"          male_guangxi = max(male_guangxi),",
				"          male_guizhou = max(male_guizhou),",
				"          male_hainan = max(male_hainan),",
				"          male_hebei = max(male_hebei),",
				"          male_heilongjiang = max(male_heilongjiang),",
				"          male_henan = max(male_henan),",
				"          male_hongkong = max(male_hongkong),",
				"          male_hubei = max(male_hubei),",
				"          male_hunan = max(male_hunan),",
				"          male_innermongolia = max(male_innermongolia),",
				"          male_jiangsu = max(male_jiangsu),",
				"          male_jiangxi = max(male_jiangxi),",
				"          male_jilin = max(male_jilin),",
				"          male_liaoning = max(male_liaoning),",
				"          male_macau = max(male_macau),",
				"          male_ningxia = max(male_ningxia),",
				"          male_qinghai = max(male_qinghai),",
				"          male_shaanxi = max(male_shaanxi),",
				"          male_shandong = max(male_shandong),",
				"          male_shanghai = max(male_shanghai),",
				"          male_shanxi = max(male_shanxi),",
				"          male_sichuan = max(male_sichuan),",
				"          male_tianjin = max(male_tianjin),",
				"          male_tibet = max(male_tibet),",
				"          male_xinjiang = max(male_xinjiang),",
				"          male_yunnan = max(male_yunnan),",
				"          male_zhejiang = max(male_zhejiang),",
				"          female_anhui = max(female_anhui),",
				"          female_beijing = max(female_beijing),",
				"          female_chongqing = max(female_chongqing),",
				"          female_fujian = max(female_fujian),",
				"          female_gansu = max(female_gansu),",
				"          female_guangdong = max(female_guangdong),",
				"          female_guangxi = max(female_guangxi),",
				"          female_guizhou = max(female_guizhou),",
				"          female_hainan = max(female_hainan),",
				"          female_hebei = max(female_hebei),",
				"          female_heilongjiang = max(female_heilongjiang),",
				"          female_henan = max(female_henan),",
				"          female_hongkong = max(female_hongkong),",
				"          female_hubei = max(female_hubei),",
				"          female_hunan = max(female_hunan),",
				"          female_innermongolia = max(female_innermongolia),",
				"          female_jiangsu = max(female_jiangsu),",
				"          female_jiangxi = max(female_jiangxi),",
				"          female_jilin = max(female_jilin),",
				"          female_liaoning = max(female_liaoning),",
				"          female_macau = max(female_macau),",
				"          female_ningxia = max(female_ningxia),",
				"          female_qinghai = max(female_qinghai),",
				"          female_shaanxi = max(female_shaanxi),",
				"          female_shandong = max(female_shandong),",
				"          female_shanghai = max(female_shanghai),",
				"          female_shanxi = max(female_shanxi),",
				"          female_sichuan = max(female_sichuan),",
				"          female_tianjin = max(female_tianjin),",
				"          female_tibet = max(female_tibet),",
				"          female_xinjiang = max(female_xinjiang),",
				"          female_yunnan = max(female_yunnan),",
				"          female_zhejiang = max(female_zhejiang),",
				"          total_anhui = (max(male_anhui) + max(female_anhui)) / 2,",
				"          total_beijing = (max(male_beijing) + max(female_beijing)) / 2,",
				"          total_chongqing = (max(male_chongqing) + max(female_chongqing)) / 2,",
				"          total_fujian = (max(male_fujian) + max(female_fujian)) / 2,",
				"          total_gansu = (max(male_gansu) + max(female_gansu)) / 2,",
				"          total_guangdong = (max(male_guangdong) + max(female_guangdong)) / 2,",
				"          total_guangxi = (max(male_guangxi) + max(female_guangxi)) / 2,",
				"          total_guizhou = (max(male_guizhou) + max(female_guizhou)) / 2,",
				"          total_hainan = (max(male_hainan) + max(female_hainan)) / 2,",
				"          total_hebei = (max(male_hebei) + max(female_hebei)) / 2,",
				"          total_heilongjiang = (max(male_heilongjiang) + max(female_heilongjiang)) / 2,",
				"          total_henan = (max(male_henan) + max(female_henan)) / 2,",
				"          total_hongkong = (max(male_hongkong) + max(female_hongkong)) / 2,",
				"          total_hubei = (max(male_hubei) + max(female_hubei)) / 2,",
				"          total_hunan = (max(male_hunan) + max(female_hunan)) / 2,",
				"          total_innermongolia = (max(male_innermongolia) + max(female_innermongolia)) / 2,",
				"          total_jiangsu = (max(male_jiangsu) + max(female_jiangsu)) / 2,",
				"          total_jiangxi = (max(male_jiangxi) + max(female_jiangxi)) / 2,",
				"          total_jilin = (max(male_jilin) + max(female_jilin)) / 2,",
				"          total_liaoning = (max(male_liaoning) + max(female_liaoning)) / 2,",
				"          total_macau = (max(male_macau) + max(female_macau)) / 2,",
				"          total_ningxia = (max(male_ningxia) + max(female_ningxia)) / 2,",
				"          total_qinghai = (max(male_qinghai) + max(female_qinghai)) / 2,",
				"          total_shaanxi = (max(male_shaanxi) + max(female_shaanxi)) / 2,",
				"          total_shandong = (max(male_shandong) + max(female_shandong)) / 2,",
				"          total_shanghai = (max(male_shanghai) + max(female_shanghai)) / 2,",
				"          total_shanxi = (max(male_shanxi) + max(female_shanxi)) / 2,",
				"          total_sichuan = (max(male_sichuan) + max(female_sichuan)) / 2,",
				"          total_tianjin = (max(male_tianjin) + max(female_tianjin)) / 2,",
				"          total_tibet = (max(male_tibet) + max(female_tibet)) / 2,",
				"          total_xinjiang = (max(male_xinjiang) + max(female_xinjiang)) / 2,",
				"          total_yunnan = (max(male_yunnan) + max(female_yunnan)) / 2,",
				"          total_zhejiang = (max(male_zhejiang) + max(female_zhejiang)) / 2) ~> AggregateGenderData",
				"SplitModelTypes@ModelEngine derive(market = 'CN',",
				"          year = '2019',",
				"          model = replace(GroupName, '/', ' '),",
				"          total_anhui = toDouble(Anhui),",
				"          total_beijing = toDouble(Beijing),",
				"          total_chongqing = toDouble(Chongqing),",
				"          total_fujian = toDouble(Fujian),",
				"          total_gansu = toDouble(Gansu),",
				"          total_guangdong = toDouble(Guangdong),",
				"          total_guangxi = toDouble(Guangxi),",
				"          total_guizhou = toDouble(Guizhou),",
				"          total_hainan = toDouble(Hainan),",
				"          total_hebei = toDouble(Hebei),",
				"          total_heilongjiang = toDouble(Heilongjiang),",
				"          total_henan = toDouble(Henan),",
				"          total_hongkong = toDouble({Hong Kong}),",
				"          total_hubei = toDouble(Hubei),",
				"          total_hunan = toDouble(Hunan),",
				"          total_innermongolia = toDouble({Inner Mongolia}),",
				"          total_jiangsu = toDouble(Jiangsu),",
				"          total_jiangxi = toDouble(Jiangxi),",
				"          total_jilin = toDouble(Jilin),",
				"          total_liaoning = toDouble(Liaoning),",
				"          total_macau = toDouble(Macau),",
				"          total_ningxia = toDouble(Ningxia),",
				"          total_qinghai = toDouble(Qinghai),",
				"          total_shaanxi = toDouble(Shaanxi),",
				"          total_shandong = toDouble(Shandong),",
				"          total_shanghai = toDouble(Shanghai),",
				"          total_shanxi = toDouble(Shanxi),",
				"          total_sichuan = toDouble(Sichuan),",
				"          total_tianjin = toDouble(Tianjin),",
				"          total_tibet = toDouble(Tibet),",
				"          total_xinjiang = toDouble(Xinjiang),",
				"          total_yunnan = toDouble(Yunnan),",
				"          total_zhejiang = toDouble(Zhejiang)) ~> DeriveEngineColumns",
				"AggregateGenderData, DeriveEngineColumns union(byName: true)~> UnionAllData",
				"UnionAllData derive(data = @(",
				"        market,",
				"        year,",
				"        model,",
				"        male_anhui,",
				"        male_beijing,",
				"        male_chongqing,",
				"        male_fujian,",
				"        male_gansu,",
				"        male_guangdong,",
				"        male_guangxi,",
				"        male_guizhou,",
				"        male_hainan,",
				"        male_hebei,",
				"        male_heilongjiang,",
				"        male_henan,",
				"        male_hongkong,",
				"        male_hubei,",
				"        male_hunan,",
				"        male_innermongolia,",
				"        male_jiangsu,",
				"        male_jiangxi,",
				"        male_jilin,",
				"        male_liaoning,",
				"        male_macau,",
				"        male_ningxia,",
				"        male_qinghai,",
				"        male_shaanxi,",
				"        male_shandong,",
				"        male_shanghai,",
				"        male_shanxi,",
				"        male_sichuan,",
				"        male_tianjin,",
				"        male_tibet,",
				"        male_xinjiang,",
				"        male_yunnan,",
				"        male_zhejiang,",
				"        female_anhui,",
				"        female_beijing,",
				"        female_chongqing,",
				"        female_fujian,",
				"        female_gansu,",
				"        female_guangdong,",
				"        female_guangxi,",
				"        female_guizhou,",
				"        female_hainan,",
				"        female_hebei,",
				"        female_heilongjiang,",
				"        female_henan,",
				"        female_hongkong,",
				"        female_hubei,",
				"        female_hunan,",
				"        female_innermongolia,",
				"        female_jiangsu,",
				"        female_jiangxi,",
				"        female_jilin,",
				"        female_liaoning,",
				"        female_macau,",
				"        female_ningxia,",
				"        female_qinghai,",
				"        female_shaanxi,",
				"        female_shandong,",
				"        female_shanghai,",
				"        female_shanxi,",
				"        female_sichuan,",
				"        female_tianjin,",
				"        female_tibet,",
				"        female_xinjiang,",
				"        female_yunnan,",
				"        female_zhejiang,",
				"        total_anhui,",
				"        total_beijing,",
				"        total_chongqing,",
				"        total_fujian,",
				"        total_gansu,",
				"        total_guangdong,",
				"        total_guangxi,",
				"        total_guizhou,",
				"        total_hainan,",
				"        total_hebei,",
				"        total_heilongjiang,",
				"        total_henan,",
				"        total_hongkong,",
				"        total_hubei,",
				"        total_hunan,",
				"        total_innermongolia,",
				"        total_jiangsu,",
				"        total_jiangxi,",
				"        total_jilin,",
				"        total_liaoning,",
				"        total_macau,",
				"        total_ningxia,",
				"        total_qinghai,",
				"        total_shaanxi,",
				"        total_shandong,",
				"        total_shanghai,",
				"        total_shanxi,",
				"        total_sichuan,",
				"        total_tianjin,",
				"        total_tibet,",
				"        total_xinjiang,",
				"        total_yunnan,",
				"        total_zhejiang",
				"    )) ~> CreateDataArray",
				"CreateDataArray aggregate(groupBy(dummy = 1),",
				"     data = collect(data)) ~> AggregateToArray",
				"AggregateToArray select(mapColumn(",
				"          data",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectDataArray",
				"SelectDataArray sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'json',",
				"     fileSystem: 'output',",
				"     partitionFileNames:['administrativeUnitCN.json'],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink1"
			]
		}
	}
}